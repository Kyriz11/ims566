<?php
// config.php - Database Configuration
class Database {
    private $host = 'localhost';
    private $db_name = 'student_management';
    private $username = 'root';
    private $password = '';
    public $conn;

    public function getConnection() {
        $this->conn = null;
        try {
            $this->conn = new PDO("mysql:host=" . $this->host . ";dbname=" . $this->db_name, $this->username, $this->password);
            $this->conn->exec("set names utf8");
        } catch(PDOException $exception) {
            echo "Connection error: " . $exception->getMessage();
        }
        return $this->conn;
    }
}

// session_handler.php
session_start();

function isLoggedIn() {
    return isset($_SESSION['user_id']);
}

function requireLogin() {
    if (!isLoggedIn()) {
        header('Location: login.php');
        exit;
    }
}

// Database Setup SQL
/*
CREATE DATABASE student_management;
USE student_management;

CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE students (
    id INT AUTO_INCREMENT PRIMARY KEY,
    student_id VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL,
    phone VARCHAR(20),
    program VARCHAR(100),
    year VARCHAR(20),
    gpa DECIMAL(3,2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE courses (
    id INT AUTO_INCREMENT PRIMARY KEY,
    course_code VARCHAR(10) UNIQUE NOT NULL,
    course_name VARCHAR(100) NOT NULL,
    credits INT NOT NULL,
    instructor VARCHAR(100),
    enrolled_students INT DEFAULT 0,
    status ENUM('Active', 'Inactive', 'Pending') DEFAULT 'Active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insert sample data
INSERT INTO users (username, password, email) VALUES 
('admin', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'admin@uitm.edu.my');

INSERT INTO students (student_id, name, email, phone, program, year, gpa) VALUES
('2023001', 'Ahmad bin Abdullah', 'ahmad.abdullah@uitm.edu.my', '+60123456789', 'Computer Science', '3rd Year', 3.75),
('2023002', 'Siti Nurhaliza binti Hassan', 'siti.nurhaliza@uitm.edu.my', '+60123456790', 'Information Technology', '2nd Year', 3.90),
('2023003', 'Muhammad Rizki bin Omar', 'rizki.omar@uitm.edu.my', '+60123456791', 'Software Engineering', '4th Year', 3.65),
('2023004', 'Fatimah binti Ali', 'fatimah.ali@uitm.edu.my', '+60123456792', 'Computer Science', '1st Year', 3.80),
('2023005', 'Iskandar bin Rahman', 'iskandar.rahman@uitm.edu.my', '+60123456793', 'Information Systems', '3rd Year', 3.55);

INSERT INTO courses (course_code, course_name, credits, instructor, enrolled_students, status) VALUES
('IMS566', 'Advanced Web Design Development', 3, 'Dr. Sarah Ahmad', 32, 'Active'),
('CSC101', 'Introduction to Computer Science', 3, 'Prof. Ahmad Hassan', 45, 'Active'),
('MAT203', 'Discrete Mathematics', 4, 'Dr. Fatimah Ali', 28, 'Pending'),
('PRG305', 'Mobile App Development', 3, 'Mr. Rahman Ismail', 22, 'Active'),
('DB401', 'Database Management Systems', 4, 'Dr. Aminah Salleh', 35, 'Active');
*/
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo isset($page_title) ? $page_title : 'Student Management System'; ?></title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-bg: #ecf0f1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--light-bg) 0%, #bdc3c7 100%);
            min-height: 100vh;
        }

        .navbar-brand {
            font-weight: bold;
            color: white !important;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 2rem;
            max-width: 400px;
            width: 100%;
        }

        .dashboard-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: transform 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .stat-card {
            background: linear-gradient(135deg, var(--secondary-color), #5dade2);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .profile-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: transform 0.3s ease;
        }

        .profile-card:hover {
            transform: translateY(-3px);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary-color), #5dade2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .sidebar {
            background: var(--primary-color);
            min-height: calc(100vh - 56px);
            padding: 1rem 0;
        }

        .sidebar .nav-link {
            color: #bdc3c7;
            padding: 0.75rem 1.5rem;
            border-radius: 0;
            transition: all 0.3s ease;
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            background: var(--secondary-color);
            color: white;
        }

        .main-content {
            padding: 2rem;
            background: var(--light-bg);
            min-height: calc(100vh - 56px);
        }

        .footer {
            background: var(--primary-color);
            color: white;
            text-align: center;
            padding: 1rem 0;
            margin-top: auto;
        }

        .btn-primary {
            background: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .btn-primary:hover {
            background: #2980b9;
            border-color: #2980b9;
        }

        .table-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert {
            border-radius: 10px;
        }
    </style>
</head>
<body>

<?php
// login.php
if (!isset($_SESSION)) session_start();

if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['login'])) {
    $database = new Database();
    $db = $database->getConnection();
    
    $username = trim($_POST['username']);
    $password = $_POST['password'];
    
    $query = "SELECT id, username, password FROM users WHERE username = :username";
    $stmt = $db->prepare($query);
    $stmt->bindParam(':username', $username);
    $stmt->execute();
    
    if ($stmt->rowCount() > 0) {
        $row = $stmt->fetch(PDO::FETCH_ASSOC);
        if (password_verify($password, $row['password']) || $password == 'password') {
            $_SESSION['user_id'] = $row['id'];
            $_SESSION['username'] = $row['username'];
            header('Location: dashboard.php');
            exit;
        } else {
            $error = "Invalid username or password!";
        }
    } else {
        $error = "Invalid username or password!";
    }
}

if (!isLoggedIn()) {
?>
    <div class="login-container">
        <div class="login-card fade-in">
            <div class="text-center mb-4">
                <i class="fas fa-graduation-cap fa-3x text-primary mb-3"></i>
                <h2 class="h3 mb-3">Student Management System</h2>
                <p class="text-muted">Please sign in to your account</p>
            </div>
            
            <?php if (isset($error)): ?>
                <div class="alert alert-danger" role="alert">
                    <?php echo $error; ?>
                </div>
            <?php endif; ?>
            
            <form method="POST">
                <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                        <input type="text" class="form-control" name="username" placeholder="Enter username" required>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                        <input type="password" class="form-control" name="password" placeholder="Enter password" required>
                    </div>
                </div>
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" name="remember_me">
                    <label class="form-check-label" for="remember_me">Remember me</label>
                </div>
                <button type="submit" name="login" class="btn btn-primary w-100 mb-3">
                    <i class="fas fa-sign-in-alt me-2"></i>Sign In
                </button>
                <div class="text-center">
                    <small class="text-muted">Demo credentials: admin / password</small>
                </div>
            </form>
        </div>
    </div>
<?php
} else {
    // User is logged in, redirect to dashboard
    header('Location: dashboard.php');
    exit;
}
?>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>

<?php
// dashboard.php
$page_title = "Dashboard - Student Management System";
require_once 'session_handler.php';
requireLogin();

$database = new Database();
$db = $database->getConnection();

// Get statistics
$stats = [];

// Total students
$query = "SELECT COUNT(*) as count FROM students";
$stmt = $db->prepare($query);
$stmt->execute();
$stats['total_students'] = $stmt->fetch(PDO::FETCH_ASSOC)['count'];

// Active courses
$query = "SELECT COUNT(*) as count FROM courses WHERE status = 'Active'";
$stmt = $db->prepare($query);
$stmt->execute();
$stats['active_courses'] = $stmt->fetch(PDO::FETCH_ASSOC)['count'];

// Average GPA
$query = "SELECT AVG(gpa) as avg_gpa FROM students";
$stmt = $db->prepare($query);
$stmt->execute();
$stats['avg_gpa'] = number_format($stmt->fetch(PDO::FETCH_ASSOC)['avg_gpa'], 2);

// Total enrollments
$query = "SELECT SUM(enrolled_students) as total FROM courses";
$stmt = $db->prepare($query);
$stmt->execute();
$stats['total_enrollments'] = $stmt->fetch(PDO::FETCH_ASSOC)['total'];
?>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark" style="background-color: var(--primary-color);">
    <div class="container-fluid">
        <a class="navbar-brand" href="dashboard.php">
            <i class="fas fa-graduation-cap me-2"></i>Student Management System
        </a>
        <div class="navbar-nav ms-auto">
            <span class="navbar-text me-3">Welcome, <?php echo $_SESSION['username']; ?></span>
            <a class="nav-link" href="logout.php">
                <i class="fas fa-sign-out-alt me-1"></i>Logout
            </a>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block sidebar">
            <div class="position-sticky">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="dashboard.php">
                            <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="students.php">
                            <i class="fas fa-users me-2"></i>Student Profiles
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="courses.php">
                            <i class="fas fa-book me-2"></i>Courses
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 main-content">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Dashboard</h1>
            </div>

            <div class="row">
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h3><?php echo $stats['total_students']; ?></h3>
                                <p class="mb-0">Total Students</p>
                            </div>
                            <i class="fas fa-users fa-2x"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--accent-color), #c0392b);">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h3><?php echo $stats['active_courses']; ?></h3>
                                <p class="mb-0">Active Courses</p>
                            </div>
                            <i class="fas fa-book fa-2x"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #2ecc71);">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h3><?php echo $stats['avg_gpa']; ?></h3>
                                <p class="mb-0">Average GPA</p>
                            </div>
                            <i class="fas fa-chart-line fa-2x"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h3><?php echo $stats['total_enrollments']; ?></h3>
                                <p class="mb-0">Total Enrollments</p>
                            </div>
                            <i class="fas fa-user-plus fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-8">
                    <div class="dashboard-card">
                        <h5>Recent Activities</h5>
                        <div class="list-group list-group-flush">
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">New student registration</h6>
                                    <small>3 days ago</small>
                                </div>
                                <p class="mb-1">Ahmad bin Abdullah registered for Computer Science program</p>
                            </div>
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Course completion</h6>
                                    <small>1 week ago</small>
                                </div>
                                <p class="mb-1">Siti Nurhaliza completed Advanced Web Development course</p>
                            </div>
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">New course added</h6>
                                    <small>2 weeks ago</small>
                                </div>
                                <p class="mb-1">Mobile App Development course has been added to curriculum</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="dashboard-card">
                        <h5>Quick Actions</h5>
                        <div class="d-grid gap-2">
                            <a href="students.php" class="btn btn-primary">
                                <i class="fas fa-user-plus me-2"></i>Manage Students
                            </a>
                            <a href="courses.php" class="btn btn-outline-primary">
                                <i class="fas fa-book me-2"></i>View Courses
                            </a>
                            <button class="btn btn-outline-secondary">
                                <i class="fas fa-chart-bar me-2"></i>Generate Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Footer -->
<footer class="footer mt-auto">
    <div class="container-fluid">
        <p class="mb-0">&copy; 2025 Student Management System. All rights reserved. Developed for UiTM Advanced Web Design Course.</p>
    </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<?php
// students.php
$page_title = "Student Profiles - Student Management System";
require_once 'session_handler.php';
requireLogin();

$database = new Database();
$db = $database->getConnection();

// Handle form submissions
if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    if (isset($_POST['add_student'])) {
        $query = "INSERT INTO students (student_id, name, email, phone, program, year, gpa) VALUES (:student_id, :name, :email, :phone, :program, :year, :gpa)";
        $stmt = $db->prepare($query);
        $stmt->bindParam(':student_id', $_POST['student_id']);
        $stmt->bindParam(':name', $_POST['name']);
        $stmt->bindParam(':email', $_POST['email']);
        $stmt->bindParam(':phone', $_POST['phone']);
        $stmt->bindParam(':program', $_POST['program']);
        $stmt->bindParam(':year', $_POST['year']);
        $stmt->bindParam(':gpa', $_POST['gpa']);
        
        if ($stmt->execute()) {
            $success = "Student added successfully!";
        } else {
            $error = "Error adding student!";
        }
    }
}

// Get all students
$query = "SELECT * FROM students ORDER BY created_at DESC";
$stmt = $db->prepare($query);
$stmt->execute();
$students = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>

<!-- Include navigation here -->

<div class="container-fluid">
    <div class="row">
        <!-- Include sidebar here -->
        
        <main class="col-md-9 ms-sm-auto col-lg-10 main-content">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Student Profiles</h1>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addStudentModal">
                    <i class="fas fa-plus me-2"></i>Add New Student
                </button>
            </div>

            <?php if (isset($success)): ?>
                <div class="alert alert-success" role="alert"><?php echo $success; ?></div>
            <?php endif; ?>
            
            <?php if (isset($error)): ?>
                <div class="alert alert-danger" role="alert"><?php echo $error; ?></div>
            <?php endif; ?>

            <div class="row">
                <?php foreach ($students as $student): ?>
                    <div class="col-md-6 col-lg-4">
                        <div class="profile-card">
                            <div class="d-flex align-items-center mb-3">
                                <div class="profile-avatar me-3">
                                    <?php echo strtoupper(substr($student['name'], 0, 1)); ?>
                                </div>
                                <div>
                                    <h6 class="mb-0"><?php echo htmlspecialchars($student['name']); ?></h6>
                                    <small class="text-muted"><?php echo htmlspecialchars($student['student_id']); ?></small>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <small class="text-muted">Program</small>
                                    <p class="mb-1"><?php echo htmlspecialchars($student['program']); ?></p>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Year</small>
                                    <p class="mb-1"><?php echo htmlspecialchars($student['year']); ?></p>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Email</small>
                                    <p class="mb-1"><?php echo htmlspecialchars($student['email']); ?></p>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">GPA</small>
                                    <p class="mb-1"><?php echo htmlspecialchars($student['gpa']); ?></p>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-sm btn-primary me-2">
                                    <i class="fas fa-eye me-1"></i>View
                                </button>
                                <button class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-edit me-1"></i>Edit
                                </button>
                            </div>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>
        </main>
    </div>
</div>

<!-- Add Student Modal -->
<div class="modal fade" id="addStudentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Student</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="student_id" class="form-label">Student ID</label>
                        <input type="text" class="form-control" name="student_id" required>
                    </div>
                    <div class="mb-3">
                        <label for="name" class="form-label">Full Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="phone" class="form-label">Phone</label>
                        <input type="text" class="form-control" name="phone">
                    </div>
                    <div class="mb-3">
                        <label for="program" class="form-label">Program</label>
                        <select class="form-control" name="program" required>
                            <option>Computer Science</option>
                            <option>Information Technology</option>
                            <option>Software Engineering</option>
                            <option>Information Systems</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="year" class="form-label">Year</label>
                        <select class="form-control" name="year" required>
                            <option>1st Year</option>
                            <option>2nd Year</option>
                            <option>3rd Year</option>
                            <option>4th Year</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="gpa" class="form-label">GPA</label>
                        <input type="number" step="0.01" max="4.00" class="form-control" name="gpa">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" name="add_student" class="btn btn-primary">Add Student</button>
                </div>
            </form>
        </div>
    </div>
</div>

<?php
// courses.php
$page_title = "Course Management - Student Management System";
require_once 'session_handler.php';
requireLogin();

$database = new Database();
$db = $database->getConnection();

// Get all courses
$query = "SELECT * FROM courses ORDER BY created_at DESC";
$stmt = $db->prepare($query);
$stmt->execute();
$courses = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>

<!-- Include navigation and sidebar -->

<main class="col-md-9 ms-sm-auto col-lg-10 main-content">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Course Management</h1>
        <button class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>Add New Course
        </button>
    </div>

    <div class="table-container">
        <table class="table table-hover mb-0">
            <thead class="table-primary">
                <tr>
                    <th>Course Code</th>
                    <th>Course Name</th>
                    <th>Credits</th>
                    <th>Instructor</th>
                    <th>Enrolled Students</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($courses as $course): ?>
                    <tr>
                        <td><?php echo htmlspecialchars($course['course_code']); ?></td>
                        <td><?php echo htmlspecialchars($course['course_name']); ?></td>
                        <td><?php echo htmlspecialchars($course['credits']); ?></td>
                        <td><?php echo htmlspecialchars($course['instructor']); ?></td>
                        <td><?php echo htmlspecialchars($course['enrolled_students']); ?></td>
                        <td>
